# Исправление ошибки загрузки файлов (500 Internal Server Error)

## Проблема
При загрузке фото получаете ошибку: `POST /api/upload 500 (Internal Server Error)`

## Причины и решения

### Причина 1: Не установлен BLOB_READ_WRITE_TOKEN

На Vercel не настроен Blob Storage или токен не установлен.

**Решение:**

1. **Создайте Vercel Blob Storage:**
   - Зайдите на [vercel.com](https://vercel.com)
   - Откройте ваш проект
   - Перейдите в **Storage** → **Create Database** → **Blob**
   - Создайте Blob Storage

2. **Проверьте переменную окружения:**
   - Перейдите в **Settings** → **Environment Variables**
   - Убедитесь, что есть переменная `BLOB_READ_WRITE_TOKEN`
   - Если её нет, она должна создаться автоматически после создания Blob Storage
   - Если всё ещё нет, пересоздайте Blob Storage

3. **Перезапустите деплой:**
   - После создания Blob Storage перезапустите деплой
   - Или сделайте новый коммит

### Причина 2: Проблема с правами доступа

Blob Storage создан, но есть проблема с доступом.

**Решение:**

1. Проверьте, что Blob Storage активен в Vercel Dashboard
2. Убедитесь, что проект правильно подключен к Blob Storage
3. Попробуйте пересоздать Blob Storage

### Причина 3: Ошибка в коде

Код обновлен для лучшей обработки ошибок. Убедитесь, что у вас последняя версия.

## Быстрая проверка

1. **Проверьте переменные окружения на Vercel:**
   ```bash
   vercel env ls
   ```
   
   Должна быть переменная `BLOB_READ_WRITE_TOKEN`

2. **Проверьте логи на Vercel:**
   - Зайдите в Vercel Dashboard
   - Откройте ваш проект
   - Перейдите в **Functions** → **Logs**
   - Найдите ошибки при загрузке файла
   - Там будет видно точную причину ошибки

## Временное решение (без Blob Storage)

Если нужно срочно загрузить файлы, код теперь использует fallback на локальное хранилище. 
**НО:** На Vercel файлы не будут сохраняться между деплоями.

Для production обязательно настройте Vercel Blob Storage!

## После исправления

1. Создайте Blob Storage на Vercel
2. Убедитесь, что `BLOB_READ_WRITE_TOKEN` установлен
3. Перезапустите деплой
4. Попробуйте загрузить файл снова

## Проверка работы

После настройки Blob Storage:
1. Загрузите тестовое изображение через админ-панель
2. Проверьте, что файл загрузился
3. Проверьте URL файла - он должен быть на `*.public.blob.vercel-storage.com`
