# Настройка переменных окружения на Vercel

## ⚠️ Критически важно: NEXTAUTH_SECRET

Если вы получаете ошибку:

```
Error: AUTH_SECRET environment variable is required in production
```

Это значит, что на Vercel не установлена переменная `NEXTAUTH_SECRET` или `AUTH_SECRET`.

## Решение:

### Шаг 1: Сгенерируйте секретный ключ

Выполните в терминале:

```bash
openssl rand -base64 32
```

Скопируйте полученный ключ (например: `xK9mP2vQ7wR4tY8uI0oP3aS6dF1gH2jK5lM8nQ1rT4vW7xY0zA3bC6eF9gH2j`)

### Шаг 2: Добавьте переменную на Vercel

#### Подробная инструкция:

1. **Зайдите на Vercel:**

   - Откройте [vercel.com](https://vercel.com) в браузере
   - Войдите в свой аккаунт

2. **Откройте ваш проект:**

   - В списке проектов найдите и нажмите на проект `ecaf` (или как он называется у вас)
   - Или перейдите по прямой ссылке: `https://vercel.com/your-username/ecaf`

3. **Перейдите в настройки:**

   - В верхнем меню проекта найдите вкладку **Settings** (Настройки)
   - Нажмите на неё

4. **Откройте раздел Environment Variables:**

   - В левом боковом меню найдите пункт **Environment Variables** (Переменные окружения)
   - Нажмите на него

5. **Добавьте новую переменную:**

   - Нажмите кнопку **Add New** (Добавить новую) или **Add** (Добавить)
   - Появится форма с тремя полями:

   **Поле 1: Key (Ключ)**

   - Введите: `NEXTAUTH_SECRET`
   - Или можете использовать: `AUTH_SECRET` (оба варианта работают)

   **Поле 2: Value (Значение)**

   - Вставьте сгенерированный ключ (который вы скопировали из терминала)
   - Это должна быть длинная строка символов, например: `xK9mP2vQ7wR4tY8uI0oP3aS6dF1gH2jK5lM8nQ1rT4vW7xY0zA3bC6eF9gH2j`

   **Поле 3: Environment (Окружение)**

   - Отметьте все три галочки:
     - ☑ Production
     - ☑ Preview
     - ☑ Development
   - Это нужно, чтобы переменная работала во всех окружениях

6. **Сохраните:**
   - Нажмите кнопку **Save** (Сохранить) внизу формы
   - Переменная появится в списке

#### Визуально это выглядит так:

```
┌─────────────────────────────────────┐
│ Key: NEXTAUTH_SECRET                │
│                                     │
│ Value: [вставьте ключ сюда]        │
│                                     │
│ Environment:                        │
│ ☑ Production                        │
│ ☑ Preview                           │
│ ☑ Development                       │
│                                     │
│        [Save]  [Cancel]            │
└─────────────────────────────────────┘
```

### Шаг 3: Перезапустите деплой

После добавления переменной нужно перезапустить деплой, чтобы изменения вступили в силу:

**Вариант 1: Через интерфейс Vercel (быстро)**

1. Перейдите во вкладку **Deployments** (Деплои) в верхнем меню проекта
2. Найдите последний деплой (самый верхний в списке)
3. Нажмите на три точки (⋮) справа от деплоя
4. Выберите **Redeploy** (Переразвернуть)
5. Подтвердите действие

**Вариант 2: Через Git (автоматически)**

Просто сделайте любой коммит и пуш:

```bash
git commit --allow-empty -m "Trigger redeploy"
git push
```

Vercel автоматически запустит новый деплой с обновленными переменными окружения.

## Все необходимые переменные на Vercel:

### Обязательные:

1. **NEXTAUTH_SECRET** или **AUTH_SECRET** ⚠️

   - Сгенерируйте: `openssl rand -base64 32`
   - Добавьте в Environment Variables

2. **NEXTAUTH_URL**

   - Ваш production домен: `https://your-project.vercel.app`
   - Или автоматический домен Vercel

3. **DATABASE_URL**
   - Если используете Prisma Postgres - создается автоматически
   - Если используете внешний провайдер - добавьте вручную

### Опциональные:

4. **BLOB_READ_WRITE_TOKEN**
   - Создается автоматически при создании Vercel Blob Storage

## Проверка переменных:

После добавления переменных проверьте:

1. Все переменные видны в Settings → Environment Variables
2. Переменные применены ко всем окружениям (Production, Preview, Development)
3. Новый деплой запущен после добавления переменных

## Если ошибка все еще появляется:

1. Убедитесь, что переменная называется именно `NEXTAUTH_SECRET` или `AUTH_SECRET`
2. Проверьте, что переменная добавлена для окружения **Production**
3. Убедитесь, что после добавления переменной был запущен новый деплой
4. Проверьте логи деплоя - там должно быть видно, какие переменные загружены
